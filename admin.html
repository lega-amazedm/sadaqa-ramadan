<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ — настройки сбора</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #071812;
            color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .wrap {
            max-width: 820px;
            margin: 0 auto;
            background: #0e2b20;
            border-radius: 18px;
            padding: 24px 22px 26px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.8);
            border: 1px solid rgba(255,215,0,0.25);
        }
        h1 {
            margin: 0 0 18px;
            font-size: 1.4rem;
        }
        h2 {
            margin: 22px 0 12px;
            font-size: 1.05rem;
            color: #FFD700;
            letter-spacing: 0.2px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        input {
            width: 100%;
            padding: 9px 11px;
            border-radius: 10px;
            border: 1px solid #284c3f;
            background: #06130e;
            color: #fff;
            box-sizing: border-box;
        }
        .row {
            margin-bottom: 14px;
        }
        button {
            border-radius: 999px;
            border: none;
            padding: 9px 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .row-buttons {
            display: flex;
            gap: 8px;
            margin-top: 6px;
            flex-wrap: wrap;
        }
        .primary {
            background: linear-gradient(135deg,#FFD700 0%,#FFA500 100%);
            color: #093322;
        }
        .ghost {
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .danger {
            background: rgba(255, 80, 80, 0.14);
            color: #fff;
            border: 1px solid rgba(255, 80, 80, 0.35);
        }
        .note {
            margin-top: 10px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.75);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }
        .panel {
            padding: 14px 14px 12px;
            border-radius: 14px;
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.08);
        }
        .bank-list {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .bank-item {
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,215,0,0.18);
            border-radius: 14px;
            padding: 12px;
        }
        .bank-item strong {
            display: block;
            margin-bottom: 6px;
        }
        .bank-item small {
            display: block;
            opacity: 0.8;
            margin-top: 4px;
            word-break: break-word;
        }
        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        @media (max-width: 760px) {
            .grid { grid-template-columns: 1fr; }
            .bank-list { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h1>Админ‑панель: сумма, контакты и реквизиты</h1>

        <div class="grid">
            <div class="panel">
                <h2>Суммы</h2>
                <div class="row">
                    <label>Цель сбора (₽)
                        <input type="number" id="goal-input" min="0" step="100">
                    </label>
                </div>
                <div class="row">
                    <label>Сколько собрано (₽)
                        <input type="number" id="collected-input" min="0" step="100">
                    </label>
                </div>
            </div>

            <div class="panel">
                <h2>Контакты</h2>
                <div class="row">
                    <label>Телефон для связи (только цифры)
                        <input type="text" id="contact-phone-input" placeholder="89887736246">
                    </label>
                </div>
                <div class="row">
                    <label>Telegram username (без @)
                        <input type="text" id="telegram-input" placeholder="k395kk">
                    </label>
                </div>
                <div class="note">
                    WhatsApp берётся из телефона (кнопка ведёт на wa.me).
                </div>
            </div>
        </div>

        <h2>Банки и реквизиты (можно добавлять несколько)</h2>
        <div class="grid">
            <div class="panel">
                <div class="row">
                    <label>Название банка
                        <input type="text" id="bank-name" placeholder="Озон Банк">
                    </label>
                </div>
                <div class="row">
                    <label>Получатель (необязательно)
                        <input type="text" id="bank-recipient" placeholder="САИД М">
                    </label>
                </div>
                <div class="row">
                    <label>Номер карты (только цифры, можно с пробелами)
                        <input type="text" id="bank-card" placeholder="2204 3210 6961 5938">
                    </label>
                </div>
                <div class="row">
                    <label>Номер телефона для перевода (необязательно)
                        <input type="text" id="bank-phone" placeholder="89887736246">
                    </label>
                </div>
                <div class="row-buttons">
                    <button class="primary" onclick="addBank()">➕ Добавить банк</button>
                    <button class="ghost" onclick="clearBankForm()">Очистить</button>
                </div>
                <div class="note">После добавления не забудьте нажать «Сохранить» ниже.</div>
            </div>

            <div class="panel">
                <div><strong>Текущий список банков:</strong></div>
                <div class="bank-list" id="bank-list"></div>
                <div class="note">Удаление действует сразу, затем нажмите «Сохранить».</div>
            </div>
        </div>

        <h2>Статистика</h2>
        <div class="panel">
            <div>Посещений с этого устройства: <strong id="visit-count">—</strong></div>
            <div class="row-buttons" style="margin-top: 10px;">
                <button class="danger" onclick="resetVisits()">Сбросить счётчик</button>
            </div>
            <div class="note">
                Важно: “сколько людей зашло всего” честно считается только через сервер/аналитику. Сейчас это счётчик в вашем браузере.
            </div>
        </div>

        <div class="row-buttons">
            <button class="primary" onclick="saveConfig()">Сохранить</button>
            <button class="ghost" onclick="resetConfig()">Сбросить</button>
        </div>
        <div class="note" id="status"></div>
    </div>

    <script>
        const DEFAULT_CONFIG = {
            goal: 50000,
            collected: 0,
            contactPhone: '89887736246',
            telegram: 'k395kk',
            banks: [
                {
                    name: 'Озон Банк',
                    recipient: 'САИД М',
                    card: '2204321069615938',
                    phone: '89887736246'
                }
            ]
        };

        function loadConfig() {
            try {
                const raw = localStorage.getItem('donationConfig');
                if (!raw) return { ...DEFAULT_CONFIG };
                const parsed = JSON.parse(raw);
                return { ...DEFAULT_CONFIG, ...parsed };
            } catch {
                return { ...DEFAULT_CONFIG };
            }
        }

        function fillForm() {
            const cfg = loadConfig();
            document.getElementById('goal-input').value = cfg.goal;
            document.getElementById('collected-input').value = cfg.collected;
            document.getElementById('contact-phone-input').value = cfg.contactPhone || '';
            document.getElementById('telegram-input').value = (cfg.telegram || '').toString().replace(/^@/, '');
            renderBankList(cfg);
            updateVisitUI();
        }

        function normalizeDigits(s) {
            return (s || '').toString().replace(/\D/g, '');
        }

        function getWorkingConfigFromForm() {
            const cfg = loadConfig();
            return {
                ...cfg,
                goal: Number(document.getElementById('goal-input').value) || 0,
                collected: Number(document.getElementById('collected-input').value) || 0,
                contactPhone: normalizeDigits(document.getElementById('contact-phone-input').value),
                telegram: (document.getElementById('telegram-input').value || '').toString().trim().replace(/^@/, ''),
            };
        }

        function saveConfig() {
            const cfg = getWorkingConfigFromForm();
            localStorage.setItem('donationConfig', JSON.stringify(cfg));
            const status = document.getElementById('status');
            status.textContent = 'Сохранено. Обновите основную страницу.';
        }

        function resetConfig() {
            localStorage.removeItem('donationConfig');
            fillForm();
            const status = document.getElementById('status');
            status.textContent = 'Настройки сброшены к значениям по умолчанию.';
        }

        function renderBankList(cfg) {
            const list = document.getElementById('bank-list');
            if (!list) return;
            const banks = Array.isArray(cfg.banks) ? cfg.banks : [];
            if (!banks.length) {
                list.innerHTML = '<div class="note">Пока нет банков. Добавьте справа.</div>';
                return;
            }
            list.innerHTML = banks.map((b, i) => `
                <div class="bank-item">
                    <strong>${(b.name || 'Банк').toString()}</strong>
                    ${b.recipient ? `<small>Получатель: ${(b.recipient || '').toString()}</small>` : ''}
                    ${b.card ? `<small class="mono">Карта: ${(b.card || '').toString()}</small>` : ''}
                    ${b.phone ? `<small class="mono">Телефон: ${(b.phone || '').toString()}</small>` : ''}
                    <div class="row-buttons" style="margin-top:10px;">
                        <button class="danger" onclick="removeBank(${i})">Удалить</button>
                    </div>
                </div>
            `).join('');
        }

        function clearBankForm() {
            document.getElementById('bank-name').value = '';
            document.getElementById('bank-recipient').value = '';
            document.getElementById('bank-card').value = '';
            document.getElementById('bank-phone').value = '';
        }

        function addBank() {
            const cfg = loadConfig();
            const bank = {
                name: (document.getElementById('bank-name').value || '').toString().trim(),
                recipient: (document.getElementById('bank-recipient').value || '').toString().trim(),
                card: normalizeDigits(document.getElementById('bank-card').value),
                phone: normalizeDigits(document.getElementById('bank-phone').value),
            };
            if (!bank.name && !bank.card && !bank.phone) {
                document.getElementById('status').textContent = 'Заполните хотя бы название и карту/телефон.';
                return;
            }
            cfg.banks = Array.isArray(cfg.banks) ? cfg.banks : [];
            cfg.banks.push(bank);
            localStorage.setItem('donationConfig', JSON.stringify(cfg));
            clearBankForm();
            renderBankList(cfg);
            document.getElementById('status').textContent = 'Банк добавлен. Нажмите «Сохранить» для закрепления остальных изменений.';
        }

        function removeBank(idx) {
            const cfg = loadConfig();
            cfg.banks = Array.isArray(cfg.banks) ? cfg.banks : [];
            cfg.banks.splice(idx, 1);
            localStorage.setItem('donationConfig', JSON.stringify(cfg));
            renderBankList(cfg);
            document.getElementById('status').textContent = 'Банк удалён. Нажмите «Сохранить» при необходимости.';
        }

        function updateVisitUI() {
            const el = document.getElementById('visit-count');
            if (!el) return;
            const current = parseInt(localStorage.getItem('visitCount') || '0', 10) || 0;
            const seen = localStorage.getItem('uniqueDeviceVisited') === '1';
            el.textContent = seen ? '1' : String(current);
        }

        function resetVisits() {
            localStorage.removeItem('visitCount');
            localStorage.removeItem('uniqueDeviceVisited');
            updateVisitUI();
            document.getElementById('status').textContent = 'Счётчик посещений сброшен на этом устройстве.';
        }

        fillForm();
    </script>
</body>
</html>

